<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TeraUnit | Global Compute Index</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <meta http-equiv="refresh" content="60"> <!-- Auto-refresh every 60s -->
    <style>
        /* Custom Scrollbar for Industrial Feel */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #111827;
        }
        ::-webkit-scrollbar-thumb {
            background: #374151;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #4B5563;
        }
    </style>
</head>
<body class="bg-gray-900 text-white font-mono min-h-screen flex flex-col">

<div class="container mx-auto p-8 flex-grow">
    <!-- HEADER -->
    <div class="flex items-center gap-5 mb-10 border-b border-gray-800 pb-6">
        <!-- Logo: MUST BE IN src/main/resources/static/logo.png -->
        <img src="/logo.svg" alt="TeraUnit Logo" class="w-16 h-16 object-contain">
        <div>
            <h1 class="text-4xl font-bold text-white tracking-tighter leading-none">
                TERAUNIT<span class="text-green-500">.AI</span>
            </h1>
            <div class="text-xs text-gray-400 tracking-[0.3em] uppercase mt-1">Global Compute Index</div>
        </div>
    </div>

    <!-- STATUS BAR -->
    <div class="flex justify-between items-center mb-6 text-xs text-gray-500 uppercase tracking-wider">
        <div class="flex items-center gap-2">
            <span class="relative flex h-2 w-2">
              <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
              <span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>
            </span>
            System Online
        </div>
        <div id="last-updated">Updating...</div>
    </div>

    <!-- PRICING GRID -->
    <div id="ticker" class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- Loading State -->
        <div class="col-span-1 md:col-span-3 p-12 border border-gray-800 rounded-lg bg-gray-800/50 text-center animate-pulse">
            <div class="text-green-500 font-bold text-xl mb-2">SCANNING GLOBAL INVENTORY</div>
            <div class="text-gray-500 text-sm">Connecting to Redis Cloud...</div>
        </div>
    </div>
</div>

<!-- FOOTER -->
<footer class="border-t border-gray-800 py-6 mt-8 text-center">
    <p class="text-gray-600 text-xs">TERAUNIT AI &copy; 2026 // INFRASTRUCTURE BROKERAGE</p>
</footer>

<script>
    async function fetchPrices() {
        try {
            const res = await fetch('/v1/pricing');
            const data = await res.json();
            const container = document.getElementById('ticker');
            container.innerHTML = '';

            // Update Timestamp
            const now = new Date();
            document.getElementById('last-updated').innerText = "LAST SYNC: " + now.toLocaleTimeString();

            // PROVIDER LOGIC
            const providers = ['lambda', 'runpod', 'vast']; // Enforce order

            providers.forEach(provider => {
                const offers = data[provider] || [];

                // CARD CONTAINER
                let html = `<div class="bg-gray-800 border border-gray-700 p-5 rounded-lg shadow-lg hover:border-gray-600 transition-colors duration-300">`;

                // CARD HEADER
                html += `<div class="flex justify-between items-center mb-4 border-b border-gray-700 pb-3">
                            <h2 class="text-xl font-bold text-white">${provider.toUpperCase()}</h2>
                            <span class="text-xs font-bold px-2 py-1 rounded ${offers.length > 0 ? 'bg-green-900/50 text-green-400' : 'bg-red-900/20 text-red-500'}">
                                ${offers.length > 0 ? 'ACTIVE' : 'OFFLINE'}
                            </span>
                         </div>`;

                if (offers.length === 0) {
                    // SOLD OUT STATE (Corrects the Lambda Issue)
                    html += `<div class="text-center py-12">
                                <svg class="w-10 h-10 mx-auto mb-3 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"></path>
                                </svg>
                                <p class="text-gray-500 font-bold">INVENTORY DEPLETED</p>
                                <p class="text-xs text-gray-600 mt-1">No spot instances available.</p>
                             </div>`;
                } else {
                    // DATA TABLE
                    html += `<div class="overflow-y-auto max-h-[500px] pr-2 space-y-2">`;

                    // Sort: Price Low -> High
                    offers.sort((a, b) => a.pricePerHour - b.pricePerHour);

                    offers.slice(0, 12).forEach(offer => {
                        // Highlight High-Value Cards (H100, 4090, 5090)
                        const isHot = ['H100', '5090', '4090'].some(model => offer.gpuModel.includes(model));
                        const highlightClass = isHot ? 'text-white' : 'text-gray-400';

                        html += `<div class="flex justify-between items-center p-2 rounded hover:bg-gray-700/50 group">
                                    <div class="flex flex-col">
                                        <span class="text-sm font-medium ${highlightClass} group-hover:text-white">${offer.gpuModel}</span>
                                        ${offer.region ? `<span class="text-[10px] text-gray-600 uppercase">${offer.region}</span>` : ''}
                                    </div>
                                    <span class="font-mono font-bold text-green-400">$${offer.pricePerHour.toFixed(3)}<span class="text-xs text-gray-600">/hr</span></span>
                                 </div>`;
                    });
                    html += `</div>`;

                    if(offers.length > 12) {
                        html += `<div class="mt-3 pt-2 border-t border-gray-700 text-center text-xs text-gray-500">
                                    + ${offers.length - 12} more items
                                 </div>`;
                    }
                }
                html += `</div>`;
                container.innerHTML += html;
            });
        } catch (e) {
            console.error("Feed lost", e);
            // Keep the old data on screen if update fails, just log error
        }
    }

    // Initial Load
    fetchPrices();

    // Poll every 60s (Redundant backup to meta-refresh)
    setInterval(fetchPrices, 60000);
</script>
</body>
</html>